name: Validate

on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main

env:
  KUBEVAL_VERSION: 0.14.0
  KUSTOMIZE_VERSION: 2.1.0

jobs:
  validate:
    name: Validate
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: Render
      uses: docker://gcr.io/k8s-skaffold/skaffold:v1.38.0
      with:
        args: render
        entrypoint: skaffold

    - name: Render (Production)
      uses: docker://gcr.io/k8s-skaffold/skaffold:v1.38.0
      with:
        args: render --profile production
        entrypoint: skaffold
